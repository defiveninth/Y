<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Tracking | Bloom & Beauty</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    .timeline {
      position: relative;
      padding: 20px 0;
    }
    
    .timeline-item {
      position: relative;
      padding-left: 60px;
      padding-bottom: 30px;
    }
    
    .timeline-item:last-child {
      padding-bottom: 0;
    }
    
    .timeline-item::before {
      content: '';
      position: absolute;
      left: 20px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: #ddd;
    }
    
    .timeline-item:last-child::before {
      display: none;
    }
    
    .timeline-icon {
      position: absolute;
      left: 7px;
      top: 0;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #fff;
      border: 3px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .timeline-icon.active {
      border-color: #dc3545;
      background: #dc3545;
      color: white;
    }
    
    .timeline-icon.completed {
      border-color: #28a745;
      background: #28a745;
      color: white;
    }
  </style>
</head>

<body>
  <header class="bg-light text-center py-3 shadow">
    <h1 class="text-danger fw-bold">Bloom & Beauty</h1>
    <nav class="navbar navbar-expand-lg navbar-light bg-light justify-content-center">
      <div class="navbar-nav">
        <a class="nav-link fw-bold" href="index.html">Home</a>
        <a class="nav-link fw-bold" href="flowers.html">Flowers</a>
        <a class="nav-link fw-bold" href="about.html">About</a>
        <a class="nav-link fw-bold" href="delivery.html">Delivery</a>
        <a class="nav-link fw-bold" href="contact.html">Contact</a>
        <div id="auth-nav" class='d-flex align-items-center'></div>
      </div>
    </nav>
  </header>

  <div class="container my-5">
    <div class="alert alert-success text-center">
      <h4>Order Placed Successfully!</h4>
      <p>Thank you for your order. Track your delivery below.</p>
    </div>
    
    <div class="row">
      <div class="col-md-8">
        <div class="card">
          <div class="card-body">
            <h4 class="mb-4">Delivery Status</h4>
            
            <div class="timeline" id="delivery-timeline">
              <div class="timeline-item">
                <div class="timeline-icon completed">✓</div>
                <div>
                  <h5>Order Confirmed</h5>
                  <p class="text-muted">Your order has been received and confirmed</p>
                  <small class="text-muted" id="time-1"></small>
                </div>
              </div>
              
              <div class="timeline-item">
                <div class="timeline-icon" id="icon-2">2</div>
                <div>
                  <h5>Preparing Your Flowers</h5>
                  <p class="text-muted">Our florists are carefully arranging your bouquet</p>
                  <small class="text-muted" id="time-2"></small>
                </div>
              </div>
              
              <div class="timeline-item">
                <div class="timeline-icon" id="icon-3">3</div>
                <div>
                  <h5>Out for Delivery</h5>
                  <p class="text-muted">Your flowers are on the way</p>
                  <small class="text-muted" id="time-3"></small>
                </div>
              </div>
              
              <div class="timeline-item">
                <div class="timeline-icon" id="icon-4">4</div>
                <div>
                  <h5>Delivered</h5>
                  <p class="text-muted">Enjoy your beautiful flowers!</p>
                  <small class="text-muted" id="time-4"></small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-md-4">
        <div class="card">
          <div class="card-body">
            <h5>Order Details</h5>
            <p><strong>Order ID:</strong> <span id="order-id"></span></p>
            <p><strong>Status:</strong> <span id="order-status" class="badge bg-warning">Pending</span></p>
            <hr>
            <a href="orders.html" class="btn btn-danger w-100">View All Orders</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="bg-danger text-white text-center py-3 mt-5">
    &copy; 2025 Bloom & Beauty | Designed by Aksunkar
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="client/js/api.js"></script>
  <script src="client/js/auth.js"></script>
  <script>
    // Protect this page
    if (!requireAuth()) {
      throw new Error("Unauthorized")
    }
    
    // Get order ID from URL
    const urlParams = new URLSearchParams(window.location.search)
    const orderId = urlParams.get('orderId')
    
    if (orderId) {
      document.getElementById("order-id").textContent = orderId
    }
    
    // Fake delivery flow simulation
    let currentStep = 1
    const steps = [
      { icon: 'icon-2', time: 'time-2', status: 'Preparing', delay: 3000 },
      { icon: 'icon-3', time: 'time-3', status: 'Out for Delivery', delay: 5000 },
      { icon: 'icon-4', time: 'time-4', status: 'Delivered', delay: 7000 },
    ]
    
    // Set initial time
    document.getElementById("time-1").textContent = new Date().toLocaleTimeString()
    
    // Simulate delivery progress
    steps.forEach((step, index) => {
      setTimeout(() => {
        const icon = document.getElementById(step.icon)
        const timeEl = document.getElementById(step.time)
        const statusBadge = document.getElementById("order-status")
        
        icon.classList.add('active')
        timeEl.textContent = new Date().toLocaleTimeString()
        
        if (index === steps.length - 1) {
          icon.classList.remove('active')
          icon.classList.add('completed')
          icon.textContent = '✓'
          statusBadge.className = 'badge bg-success'
          statusBadge.textContent = 'Delivered'
        } else {
          statusBadge.className = 'badge bg-warning'
          statusBadge.textContent = step.status
          
          // Complete previous step
          if (index > 0) {
            const prevIcon = document.getElementById(steps[index - 1].icon)
            prevIcon.classList.remove('active')
            prevIcon.classList.add('completed')
            prevIcon.textContent = '✓'
          }
        }
      }, step.delay)
    })
  </script>
</body>
</html>
